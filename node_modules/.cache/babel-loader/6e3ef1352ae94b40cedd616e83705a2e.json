{"ast":null,"code":"var checkParameters = require('./precondition');\n\nvar defaultEncoding = require('./default-encoding');\n\nvar sync = require('./sync');\n\nvar Buffer = require('safe-buffer').Buffer;\n\nvar ZERO_BUF;\nvar subtle = global.crypto && global.crypto.subtle;\nvar toBrowser = {\n  'sha': 'SHA-1',\n  'sha-1': 'SHA-1',\n  'sha1': 'SHA-1',\n  'sha256': 'SHA-256',\n  'sha-256': 'SHA-256',\n  'sha384': 'SHA-384',\n  'sha-384': 'SHA-384',\n  'sha-512': 'SHA-512',\n  'sha512': 'SHA-512'\n};\nvar checks = [];\n\nfunction checkNative(algo) {\n  if (global.process && !global.process.browser) {\n    return Promise.resolve(false);\n  }\n\n  if (!subtle || !subtle.importKey || !subtle.deriveBits) {\n    return Promise.resolve(false);\n  }\n\n  if (checks[algo] !== undefined) {\n    return checks[algo];\n  }\n\n  ZERO_BUF = ZERO_BUF || Buffer.alloc(8);\n  var prom = browserPbkdf2(ZERO_BUF, ZERO_BUF, 10, 128, algo).then(function () {\n    return true;\n  }).catch(function () {\n    return false;\n  });\n  checks[algo] = prom;\n  return prom;\n}\n\nfunction browserPbkdf2(password, salt, iterations, length, algo) {\n  return subtle.importKey('raw', password, {\n    name: 'PBKDF2'\n  }, false, ['deriveBits']).then(function (key) {\n    return subtle.deriveBits({\n      name: 'PBKDF2',\n      salt: salt,\n      iterations: iterations,\n      hash: {\n        name: algo\n      }\n    }, key, length << 3);\n  }).then(function (res) {\n    return Buffer.from(res);\n  });\n}\n\nfunction resolvePromise(promise, callback) {\n  promise.then(function (out) {\n    process.nextTick(function () {\n      callback(null, out);\n    });\n  }, function (e) {\n    process.nextTick(function () {\n      callback(e);\n    });\n  });\n}\n\nmodule.exports = function (password, salt, iterations, keylen, digest, callback) {\n  if (typeof digest === 'function') {\n    callback = digest;\n    digest = undefined;\n  }\n\n  digest = digest || 'sha1';\n  var algo = toBrowser[digest.toLowerCase()];\n\n  if (!algo || typeof global.Promise !== 'function') {\n    return process.nextTick(function () {\n      var out;\n\n      try {\n        out = sync(password, salt, iterations, keylen, digest);\n      } catch (e) {\n        return callback(e);\n      }\n\n      callback(null, out);\n    });\n  }\n\n  checkParameters(password, salt, iterations, keylen);\n  if (typeof callback !== 'function') throw new Error('No callback provided to pbkdf2');\n  if (!Buffer.isBuffer(password)) password = Buffer.from(password, defaultEncoding);\n  if (!Buffer.isBuffer(salt)) salt = Buffer.from(salt, defaultEncoding);\n  resolvePromise(checkNative(algo).then(function (resp) {\n    if (resp) return browserPbkdf2(password, salt, iterations, keylen, algo);\n    return sync(password, salt, iterations, keylen, digest);\n  }), callback);\n};","map":{"version":3,"names":["checkParameters","require","defaultEncoding","sync","Buffer","ZERO_BUF","subtle","global","crypto","toBrowser","checks","checkNative","algo","process","browser","Promise","resolve","importKey","deriveBits","undefined","alloc","prom","browserPbkdf2","then","catch","password","salt","iterations","length","name","key","hash","res","from","resolvePromise","promise","callback","out","nextTick","e","module","exports","keylen","digest","toLowerCase","Error","isBuffer","resp"],"sources":["/Users/zhuyihan/Downloads/patronus/node_modules/pbkdf2/lib/async.js"],"sourcesContent":["var checkParameters = require('./precondition')\nvar defaultEncoding = require('./default-encoding')\nvar sync = require('./sync')\nvar Buffer = require('safe-buffer').Buffer\n\nvar ZERO_BUF\nvar subtle = global.crypto && global.crypto.subtle\nvar toBrowser = {\n  'sha': 'SHA-1',\n  'sha-1': 'SHA-1',\n  'sha1': 'SHA-1',\n  'sha256': 'SHA-256',\n  'sha-256': 'SHA-256',\n  'sha384': 'SHA-384',\n  'sha-384': 'SHA-384',\n  'sha-512': 'SHA-512',\n  'sha512': 'SHA-512'\n}\nvar checks = []\nfunction checkNative (algo) {\n  if (global.process && !global.process.browser) {\n    return Promise.resolve(false)\n  }\n  if (!subtle || !subtle.importKey || !subtle.deriveBits) {\n    return Promise.resolve(false)\n  }\n  if (checks[algo] !== undefined) {\n    return checks[algo]\n  }\n  ZERO_BUF = ZERO_BUF || Buffer.alloc(8)\n  var prom = browserPbkdf2(ZERO_BUF, ZERO_BUF, 10, 128, algo)\n    .then(function () {\n      return true\n    }).catch(function () {\n      return false\n    })\n  checks[algo] = prom\n  return prom\n}\n\nfunction browserPbkdf2 (password, salt, iterations, length, algo) {\n  return subtle.importKey(\n    'raw', password, {name: 'PBKDF2'}, false, ['deriveBits']\n  ).then(function (key) {\n    return subtle.deriveBits({\n      name: 'PBKDF2',\n      salt: salt,\n      iterations: iterations,\n      hash: {\n        name: algo\n      }\n    }, key, length << 3)\n  }).then(function (res) {\n    return Buffer.from(res)\n  })\n}\n\nfunction resolvePromise (promise, callback) {\n  promise.then(function (out) {\n    process.nextTick(function () {\n      callback(null, out)\n    })\n  }, function (e) {\n    process.nextTick(function () {\n      callback(e)\n    })\n  })\n}\nmodule.exports = function (password, salt, iterations, keylen, digest, callback) {\n  if (typeof digest === 'function') {\n    callback = digest\n    digest = undefined\n  }\n\n  digest = digest || 'sha1'\n  var algo = toBrowser[digest.toLowerCase()]\n\n  if (!algo || typeof global.Promise !== 'function') {\n    return process.nextTick(function () {\n      var out\n      try {\n        out = sync(password, salt, iterations, keylen, digest)\n      } catch (e) {\n        return callback(e)\n      }\n      callback(null, out)\n    })\n  }\n\n  checkParameters(password, salt, iterations, keylen)\n  if (typeof callback !== 'function') throw new Error('No callback provided to pbkdf2')\n  if (!Buffer.isBuffer(password)) password = Buffer.from(password, defaultEncoding)\n  if (!Buffer.isBuffer(salt)) salt = Buffer.from(salt, defaultEncoding)\n\n  resolvePromise(checkNative(algo).then(function (resp) {\n    if (resp) return browserPbkdf2(password, salt, iterations, keylen, algo)\n\n    return sync(password, salt, iterations, keylen, digest)\n  }), callback)\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}